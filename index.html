<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type"text/css" href="lib/css/main.css">
    <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,300,700' rel='stylesheet' type='text/css'>
    <script src="lib/jquery.js"></script>
    <script src="lib/jquery.timeago.js"></script>
    <script src="lib/data_generator.js"></script>
    <title>Twittler</title>
  </head>
  <body>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        $body.html('');

        // gathers all the tweet divs into a div called feed
        $body.append('<div class="feed"></feed>');
        var $feed = $('.feed');
        var feedHeight = function() {
          return (loaded + 1)* 39;
        }


        // adds a button to refresh the feed
        // as of now this button has no functionality
        $feed.append('<div><button name="refresh">New Tweets</button></div>');
        var $refresh = $('button[name="refresh"]');

        // tweet loading functionality in function loadTweet
        var loadTweet = function (index){
          var tweet = streams.home[index];
          // added a class for tweet-box
          var $tweet = $('<div class="tweet-box new"></div>');
          // creates a timestamp using the timeago library from http://timeago.yarp.com/
          var timestamp = '</div><div class="time">' + /*jQuery.timeago*/(tweet.created_at) + '</div>';
          // put user in a span with class user
          $tweet.append('<div><span class="user">@' + tweet.user + '</span> ' + tweet.message +
            timestamp);
          $refresh.after($tweet);
        };

        // variable to store the number of loaded tweets
        var loaded = streams.home.length;
        // fills the starting feed with tweets from streams
        var index = loaded - 1;
        while(index >= 0){
          loadTweet(index);
          $('.new').removeClass('new');
          index -= 1;
        }

        $refresh.on('click', function () {
          var total = streams.home.length;
          var tBoxTop = -5 + 39 * (total-loaded);
          for (var i = total-1; i >= loaded; i--){
            loadTweet(i);
          };
          loaded = total;
          $feed.animate({height: feedHeight()});
          $('.tweet-box').animate({top: tBoxTop}, function () {
            $('.tweet-box').css({top: -5});
            $('.new').fadeIn();
          });
        });

      });

    </script>
  </body>
</html>
